{{define "main"}}
<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="google-signin-cookiepolicy" content="single_host_origin" />
  <title>{{.PageTitle}} - {{.PageDesc}}</title>
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <link rel="stylesheet" href="{{.BaseUrl}}vendors/bootstrap/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="{{.BaseUrl}}vendors/font-awesome/css/font-awesome.css" />
  <link rel="stylesheet" href="{{.BaseUrl}}vendors/theme/dist/css/theme.css">
  <link rel="stylesheet" href="{{.BaseUrl}}vendors/theme/dist/css/skins/skin-red.css">
  <link rel="stylesheet" href="{{.BaseUrl}}css/style.css">
  <link rel="stylesheet" href="{{.BaseUrl}}vendors/datatables/media/css/dataTables.bootstrap.css">
  <link rel="stylesheet" href="{{.BaseUrl}}vendors/PACE/themes/yellow/pace-theme-loading-bar.css">
  <link rel="stylesheet" href="{{.BaseUrl}}vendors/blueimp-file-upload/css/jquery.fileupload.css">
  <link rel="stylesheet" href="{{.BaseUrl}}vendors/css-spinners/css/spinner/dots.css">
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <link rel="stylesheet" href="{{.BaseUrl}}vendors/theme/plugins/iCheck/square/blue.css">

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body class="hold-transition login-page">
  <div class="login-box">

    <div class="login-logo">
      <b>LINQ</b>Dev
    </div>
    <!-- /.login-logo -->
    <div class="login-box-body">
      <p class="login-box-msg">Sign in to start your session</p>

      <div class="social-auth-links text-center">
        <button class="btn btn-block btn-social btn-google btn-flat signin-google">
          <i class="fa fa-google-plus"></i> Sign in using Google
        </button>
      </div>
      <!-- /.social-auth-links -->

      <form method="post">
        <div class="form-group has-feedback">
          <input id="a0-signin_easy_email" type="email" class="form-control" placeholder="Email">
          <span class="glyphicon glyphicon-envelope form-control-feedback"></span>
        </div>
        <div class="form-group has-feedback">
          <input id="password" type="password" class="form-control" placeholder="Password">
          <span class="glyphicon glyphicon-lock form-control-feedback"></span>
        </div>
        <div class="row">
          <!-- /.col -->
          <br/>
          <div class="col-xs-4">
            <button type="submit" class="btn btn-primary btn-block btn-fla signin-db">Sign In</button>
          </div>
          <!-- /.col -->
        </div>
      </form>

      <a href="#">I forgot my password</a>
    </div>
    <!-- /.login-box-body -->
  </div>
  <!-- /.login-box -->
  <script src="{{.BaseUrl}}vendors/jquery/dist/jquery.min.js"></script>
  <script src="{{.BaseUrl}}vendors/bootstrap/dist/js/bootstrap.min.js"></script>
  <script src="{{.BaseUrl}}vendors/theme/plugins/iCheck/icheck.min.js"></script>
  <script src="https://apis.google.com/js/client:platform.js"></script>

  <script>
    // var auth0 = new Auth0({
    //   domain: 'linq.auth0.com',
    //   clientID: 'a98rUrbNXIgr7U5D1vaIvVlTs2BgTccp',
    //   callbackURL: 'https://linq-sofyan-a-1.c9users.io/login/callback'
    // });
    var additionalParams = {
      hd: "linq.im",
      'callback': signinCallback
    };
    
    function authenticate(token) {
      var redirectUrl = params["redirectUrl"] == undefined ? '' : params['redirectUrl'];
      $.ajax({
          type: "POST",
          url: "/dashboard/auth/login?redirectUrl=" + redirectUrl,
          data: JSON.stringify({
              authType: "google",
              accessToken: "Bearer " + token
          }),
          processData: false,
          contentType: "application/json",
          dataType: "text",
          success: function(data) {
              showSuccessMessage("Authenticated, redirecting...");
              window.location.href = data;
          },
          error: function(jqXHR) {
              var errorText = '';
              try {
                  errorText = $.parseJSON(jqXHR.responseText);
              } catch (e) {
                  errorText = jqXHR.responseText;
              }
              showErrorMessage(errorText);
              $('#loginbox' ).addClass('loginbox--error')
          }
      });
    }

    function signinCallback(authResult) {
      if (authResult['status']['signed_in']) {
        if (authResult['status']['method'] === 'PROMPT') {
          authenticate(authResult['access_token']);
        }
      }
    }


    // sign-in with social provider with plain redirect
    $('.signin-google').on('click', function() {
      gapi.auth.signIn();
    });

    // sign-in with social provider with plain redirect
    $('.signin-facebook').on('click', function() {
      auth0.signin({
        connection: 'facebook'
      }); // use connection identifier
    });

    $('.signin-db').on('click', function() {
      event.preventDefault();
      auth0.signin({
          connection: 'database',
          username: $("#a0-signin_easy_email").val(),
          password: $("#password").val()
        },
        function(err, profile, id_token, access_token, state) {
          $.cookie('profile', profile);
          $.cookie('id_token', id_token);
        });
    });
  </script>
</body>

</html>
{{end}}